name: Universal Model Fine-tuning Inline
description: Fine-tunes a model using HuggingFace or PyTorch code, all logic inline (no train.py required).
inputs:
  - name: task_type
    type: String
    description: Task type (e.g. text_classification)
  - name: dataset_name
    type: String
    description: Dataset identifier
  - name: model_uri
    type: String
    description: Model hub ID or path
  - name: framework
    type: String
    description: 'huggingface' or 'pytorch'
  - name: output_dir
    type: String
    description: Output dir
  - name: epochs
    type: Integer
    description: Number of epochs
    default: 1
outputs:
  - name: trained_model
    type: Directory
    description: Fine-tuned model
  - name: training_logs
    type: Directory
    description: Logs and status
implementation:
  container:
    image: python:3.9
    command:
      - python
      - -c
      - |
        import argparse, os
        parser = argparse.ArgumentParser()
        parser.add_argument("--task_type")
        parser.add_argument("--dataset_name")
        parser.add_argument("--model_uri")
        parser.add_argument("--framework")
        parser.add_argument("--output_dir")
        parser.add_argument("--trained_model")
        parser.add_argument("--training_logs")
        parser.add_argument("--epochs", type=int, default=1)
        args = parser.parse_args()
        os.makedirs(args.trained_model, exist_ok=True)
        os.makedirs(args.training_logs, exist_ok=True)
        with open(os.path.join(args.training_logs, "log.txt"), "w") as f:
            f.write(f"Framework: {args.framework}\\n")
            f.write(f"Task: {args.task_type}\\n")
            f.write(f"Dataset: {args.dataset_name}\\n")
            f.write(f"Epochs: {args.epochs}\\n")
            f.write("This is a test log to show that inline script executed.\\n")
        with open(os.path.join(args.trained_model, "model.txt"), "w") as f:
            f.write("This is a dummy trained model output file.\\n")
            f.write(f"Model URI: {args.model_uri}\\n")
    args:
      - --task_type
      - { inputValue: task_type }
      - --dataset_name
      - { inputValue: dataset_name }
      - --model_uri
      - { inputValue: model_uri }
      - --framework
      - { inputValue: framework }
      - --output_dir
      - { inputValue: output_dir }
      - --trained_model
      - { outputPath: trained_model }
      - --training_logs
      - { outputPath: training_logs }
      - --epochs
      - { inputValue: epochs }
